{% extends "layouts/base.html" %}

{% block extra_css %}
<style>
    /* Design simplifié comme sur la capture */
    #calendar {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,46,109,0.1);
        padding: 15px;
    }

    .fc-toolbar-title {
        font-size: 1.3rem;
        color: var(--primary-dark);
    }

    .fc-button {
        background: white !important;
        border: 1px solid #e0e0e0 !important;
        color: var(--primary-dark) !important;
    }

    .fc-button-active {
        background: var(--primary-medium) !important;
        color: white !important;
    }

    .fc-daygrid-day {
        border: 1px solid #f0f0f0 !important;
    }

    .fc-daygrid-day-number {
        color: var(--primary-dark);
        font-weight: 500;
        padding: 4px !important;
    }

    .fc-col-header-cell {
        padding: 8px 0;
    }

    .fc-col-header-cell-cushion {
        color: var(--primary-medium);
        font-size: 0.85em;
    }

    .fc-event {
        border: none !important;
        border-radius: 4px !important;
        padding: 2px 4px !important;
        margin: 1px 2px !important;
        font-size: 0.8em !important;
    }

    .fc-event-title {
        white-space: normal !important;
        line-height: 1.3 !important;
    }

    .fc-daygrid-event-dot {
        display: none !important;
    }
    .fc {
        font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    }
    
    /* Conteneur principal */
    #calendar {
        background: white;
        border-radius: 8px;
        padding: 15px;
        max-width: 900px;
        margin: 0 auto;
    }
    
    /* En-tête */
    .fc-header-toolbar {
        margin-bottom: 15px !important;
    }
    
    .fc-toolbar-title {
        font-size: 1.3rem;
        color: #333;
        font-weight: 600;
    }
    
    .fc-button {
        background: transparent !important;
        border: 1px solid #ddd !important;
        color: #333 !important;
        box-shadow: none !important;
        font-size: 0.9rem;
        padding: 5px 10px !important;
    }
    
    .fc-button:hover {
        background: #f5f5f5 !important;
    }
    
    /* Jours de la semaine */
    .fc-col-header-cell {
        padding: 8px 0;
    }
    
    .fc-col-header-cell-cushion {
        color: #555;
        font-size: 0.8rem;
        font-weight: 500;
        text-transform: uppercase;
    }
    
    /* Cellules des jours */
    .fc-daygrid-day-frame {
        min-height: 80px;
    }
    
    .fc-daygrid-day-number {
        color: #333;
        font-size: 0.9rem;
        padding: 4px 6px 0 0 !important;
    }
    
    .fc-day-today {
        background-color: rgba(0, 123, 255, 0.1) !important;
    }
    
    .fc-daygrid-day-top {
        justify-content: flex-start;
    }
    
    /* Événements */
    .fc-event {
        border: none !important;
        border-radius: 3px !important;
        padding: 2px 4px !important;
        margin: 1px 0 !important;
        font-size: 0.8rem !important;
        background-color: #4a6bda;
        color: white;
    }
    
    .fc-event-title {
        white-space: normal !important;
        line-height: 1.3 !important;
    }
    
    /* "+X more" */
    .fc-daygrid-more-link {
        font-size: 0.75rem;
        color: #666;
    }

</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0">Calendrier des Séminaires</h1>
        <button class="btn btn-download" data-bs-toggle="modal" data-bs-target="#addSeminaireModal">
            <i class="bi bi-plus-circle"></i> Nouveau séminaire
        </button>
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-3">
            <div id="calendar"></div>
        </div>
    </div>
</div>

<!-- Modal Ajout Séminaire -->
<div class="modal fade" id="addSeminaireModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Ajouter un Séminaire</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{{ url_for('add_seminaire') }}">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label for="title" class="form-label">Titre*</label>
                            <input type="text" class="form-control" id="title" name="title" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="type" class="form-label">Type*</label>
                            <select class="form-select" id="type" name="type" required>
                                <option value="conference">Conférence</option>
                                <option value="workshop">Atelier</option>
                                <option value="thesis">Soutenance</option>
                                <option value="meeting">Réunion</option>
                                <option value="other">Autre</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="speaker" class="form-label">Intervenant(s)*</label>
                        <input type="text" class="form-control" id="speaker" name="speaker" required>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="date" class="form-label">Date*</label>
                            <input type="date" class="form-control" id="date" name="date" required>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="time" class="form-label">Heure*</label>
                            <input type="time" class="form-control" id="time" name="time" required>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="duration" class="form-label">Durée (min)*</label>
                            <input type="number" class="form-control" id="duration" name="duration" value="90" min="15" step="15" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="location" class="form-label">Lieu*</label>
                        <input type="text" class="form-control" id="location" name="location" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-download">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>
</div>



<!-- Stockage des données pour JavaScript -->
<div id="calendar-data" 
     data-events="{{ events|tojson|forceescape }}"
     style="display:none;">
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/fr.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
        initialView: 'dayGridMonth',
        locale: 'fr',
        headerToolbar: {
            left: 'title',
            center: '',
            right: 'today prev,next'
        },
        dayHeaderContent: function(arg) {
            return arg.text.substring(0, 3); // Jours sur 3 lettres
        },
        dayCellContent: function(arg) {
            return { html: arg.dayNumberText }; // Numéros simples
        },
        events: [
            // Exemple basique
            {
                title: 'All Day Event',
                start: new Date().toISOString().split('T')[0],
                color: '#4a6bda'
            },
            {
                title: 'Long Event',
                start: new Date(new Date().setDate(new Date().getDate() + 2)).toISOString().split('T')[0],
                end: new Date(new Date().setDate(new Date().getDate() + 5)).toISOString().split('T')[0],
                color: '#6c5ce7'
            }
        ],
        eventContent: function(arg) {
            return {
                html: `<div class="fc-event-title">${arg.event.title}</div>`
            };
        }
    });

    calendar.render();
});
</script>
{% endblock %}